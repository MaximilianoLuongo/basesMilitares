<!DOCTYPE html>
<html>
<head>
  <title>Instalaciones Militares de la República Argentina</title>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }
    #mapa {
      height: 100%;
      width: 100%;
    }
  </style>
</head>
<body>
  <h3>Mapa nacional de instituciones militares</h3>
  <div id="mapa"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>
  <script>
    // Inicializar mapa centrado en Argentina
    var map = L.map('mapa').setView([-39.0, -66.0], 4.5);

    // Base map con transparencia
    var baseMap = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 20,
      attribution: '© OpenStreetMap contributors',
      opacity: 0.7   // transparencia del mapa base
    }).addTo(map);

    // Capa WMS del IGN (Provincias)
    var provincias = L.tileLayer.wms("https://wms.ign.gob.ar/geoserver/ows?", {
        layers: "ign:provincia",
        format: "image/png",
        transparent: true,
        version: "1.3.0",
        attribution: "Instituto Geográfico Nacional (IGN)"
    }).addTo(map);

    // Función para crear íconos dinámicos
    function getIcon(fuerza, size) {
      let iconUrl = "ejercito.png"; // valor por defecto
      if (fuerza === "Armada Argentina") iconUrl = "armada.png";
      if (fuerza === "Fuerza Aérea Argentina") iconUrl = "fuerzaAerea.png";

      return L.icon({
        iconUrl: iconUrl,
        iconSize: [size, size],
        iconAnchor: [size/2, size],
        popupAnchor: [0, -size]
      });
    }

    var instMilitares; // capa global

    // Cargar GeoJSON de instituciones militares
    fetch("instMilitares.geojson")
      .then(response => response.json())
      .then(data => {
        instMilitares = L.geoJSON(data, {
          pointToLayer: function (feature, latlng) {
            var fuerza = feature.properties.fdc; 
            var size = map.getZoom() < 5 ? 20 : 40; // íconos más chicos si el zoom está lejos
            return L.marker(latlng, { icon: getIcon(fuerza, size) });
          },
          onEachFeature: function (feature, layer) {
            let props = feature.properties;
            let popupContent = `<b>${props.fna || ''}</b><br>
                                <i>${props.fdc || ''}</i><br>
                                ${props.gna || ''} ${props.nam || ''}`;
            layer.bindPopup(popupContent);
          }
        }).addTo(map);

        // Control de capas
        L.control.layers(
          { "Mapa Base": baseMap, "Provincias IGN": provincias },
          { "Instituciones Militares": instMilitares }
        ).addTo(map);
      });

    // Evento para redimensionar íconos al cambiar zoom
    map.on('zoomend', function() {
      if (!instMilitares) return;
      var currentZoom = map.getZoom();
      var size = currentZoom < 5 ? 20 : 40;

      instMilitares.eachLayer(function(layer) {
        var fuerza = layer.feature.properties.fdc;
        layer.setIcon(getIcon(fuerza, size));
      });
    });
  </script>
</body>
</html>
