<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Mapa Nacional de Instituciones Militares</title>

  <!-- Leaflet y complementos -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css" />

  <style>
    html, body { height: 100%; margin: 0; padding: 0; }
    #mapa { height: 100%; width: 100%; }

    /* ======== T√çTULO ======== */
    .titulo-militar {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1000;
      background-color: rgba(255, 255, 255, 0.85);
      padding: 10px 18px;
      border-radius: 10px;
      font-family: 'Arial Black', 'Impact', sans-serif;
      color: #556b2f;
      font-size: 20px;
      letter-spacing: 1.5px;
      text-shadow: 1px 1px 2px #333;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }

    /* ======== √çCONOS ======== */
    .leaflet-marker-icon {
      filter: drop-shadow(0 0 4px #000);
      transition: transform 0.2s ease, filter 0.2s ease;
    }
    .leaflet-marker-icon:hover {
      transform: scale(1.2);
      filter: drop-shadow(0 0 6px #ffd700);
    }

    /* ======== LEYENDA ======== */
    .legend {
      position: absolute;
      bottom: 15px;
      right: 15px;
      z-index: 1000;
      background-color: rgba(255,255,255,0.9);
      padding: 10px;
      border-radius: 10px;
      font-family: Arial, sans-serif;
      font-size: 13px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
    }
    .legend img {
      width: 22px;
      height: 22px;
      vertical-align: middle;
      margin-right: 6px;
    }
    .legend b {
      display: block;
      text-align: center;
      margin-bottom: 6px;
      color: #333;
    }

    /* ======== BOT√ìN ZOOM ======== */
    .custom-button {
      position: absolute;
      top: 70px;
      left: 10px;
      z-index: 1000;
      background-color: #6e7a26;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0,0,0,0.3);
      transition: background-color 0.2s;
    }
    .custom-button:hover { background-color: #879738; }
  </style>
</head>

<body>
  <h3 class="titulo-militar">Mapa Nacional de Instituciones Militares</h3>
  <button class="custom-button" id="zoomBtn">üîç Centrar en Argentina</button>
  <div id="mapa"></div>

  <div class="legend">
    <b>Fuerzas Armadas</b>
    <p><img src="ejercito.png">Ej√©rcito Argentino</p>
    <p><img src="armada.png">Armada Argentina</p>
    <p><img src="fuerzaAerea.png">Fuerza A√©rea Argentina</p>
  </div>

  <!-- Scripts -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>

  <script>
    // ======= INICIALIZACI√ìN DEL MAPA =======
    var map = L.map('mapa', {
      center: [0, 0],
      zoom: 2,
      zoomControl: true
    });

    // ======= MAPAS BASE =======
    var baseIGN = L.tileLayer('https://wms.ign.gob.ar/geoserver/gwc/service/tms/1.0.0/capabaseargenmap@EPSG%3A3857@png/{z}/{x}/{-y}.png', {
      maxZoom: 20,
      attribution: '&copy; IGN Argentina'
    }).addTo(map);

    var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap'
    });

    var satelite = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
      attribution: '&copy; Esri World Imagery'
    });

    // ======= CAPA WMS DE PROVINCIAS =======
    var provincias = L.tileLayer.wms("https://wms.ign.gob.ar/geoserver/ows?", {
      layers: "ign:provincia",
      format: "image/png",
      transparent: true,
      version: "1.3.0",
      attribution: "IGN"
    }).addTo(map);

    // ======= FUNCI√ìN DE √çCONOS =======
    function getIcon(fuerza) {
      let iconUrl = "ejercito.png";
      if (fuerza === "Armada Argentina") iconUrl = "armada.png";
      if (fuerza === "Fuerza A√©rea Argentina") iconUrl = "fuerzaAerea.png";

      return L.icon({
        iconUrl: iconUrl,
        iconSize: [42, 42],
        iconAnchor: [21, 42],
        popupAnchor: [0, -40]
      });
    }

    // ======= CLUSTER DE MARCADORES =======
    var markersCluster = L.markerClusterGroup();

    // ======= CARGAR GEOJSON =======
    fetch("instMilitares.geojson")
      .then(response => response.json())
      .then(data => {
        var instMilitares = L.geoJSON(data, {
          pointToLayer: function (feature, latlng) {
            var fuerza = feature.properties.fdc;
            return L.marker(latlng, { icon: getIcon(fuerza) });
          },
          onEachFeature: function (feature, layer) {
            let props = feature.properties;
            let popupContent = `
              <div style="text-align:center;">
                <img src="${getIcon(props.fdc).options.iconUrl}" width="35"><br>
                <b style="color:#4b5320;">${props.fna || 'Sin nombre'}</b><br>
                <i>${props.fdc || 'Sin fuerza definida'}</i><br>
                ${props.gna ? `<small>Guarnici√≥n: ${props.gna}</small><br>` : ''}
                ${props.nam ? `<small>Nombre alternativo: ${props.nam}</small>` : ''}
              </div>`;
            layer.bindPopup(popupContent);
          }
        });

        markersCluster.addLayer(instMilitares);
        map.addLayer(markersCluster);

        // Bot√≥n para centrar en todas las instituciones
        document.getElementById("zoomBtn").addEventListener("click", function(){
          map.fitBounds(markersCluster.getBounds(), { padding: [30, 30] });
        });

        // Control de capas
        L.control.layers(
          {
            "IGN Base": baseIGN,
            "OpenStreetMap": osm,
            "Sat√©lite": satelite
          },
          {
            "Provincias IGN": provincias,
            "Instituciones Militares": markersCluster
          },
          { collapsed: false }
        ).addTo(map);

        // ======= ANIMACI√ìN INICIAL =======
        setTimeout(() => {
          map.flyTo([-38.5, -63.5], 5, { duration: 4 });
        }, 1200);
      })
      .catch(error => console.error("Error al cargar GeoJSON:", error));
  </script>
</body>
</html>
